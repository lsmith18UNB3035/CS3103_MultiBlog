<!DOCTYPE html>
<html>
    <head>
        <title>Multi-User Blog Service</title>
    </head>
    <body>
        <div class="container-fluid" id="app" style="padding-bottom:50px">
            <div class="jumbotron jumbotron-fluid text-center">
                <div class="text-center">
                    <h2><a href="https://cs3103.cs.unb.ca:8027/static/blogService.html">Link to Webpage on Server</a></h2>
                </div>
                <h1>Welcome to Multi-User Blog Service<sup><small>TM</small></sup></sup></h1>
                <div v-if="!authenticated" class="form-group text-center">
                    <input class="col-4 mx-auto form-control" type="text" name="username" v-model="input.username" placeholder="Username" />
                    <input class="col-4 mx-auto form-control" type="password" name="password" v-model="input.password" placeholder="Password" />
                    <button class="col-4 btn btn-outline-success" type="button" v-on:click="login()"><i class="fa fa-sign-in" aria-hidden="true"></i>Login</button>
                </div>
                <div v-else class="text-center">
                    <button type="button" class="btn btn-outline-danger" v-on:click="logout()"><i class="fa fa-sign-out" aria-hidden="true"></i>Logout</button>
                    <button type="button" class="btn btn-outline-primary" v-on:click="getBlogsByUser()"><i class="fa fa-home" aria-hidden="true"></i></button>
                    <div class="text-right" style="padding-right:50px">
                        <button type="button" class="btn btn-outline-primary" v-on:click="showWriteModal()"><i class="fa fa-pencil-square-o" aria-hidden="true"></i>New Blog</button>
                    </div>
                </div>
                <div><p>{{bannerContent.badLogin}}</p></div>
            </div>
            <div v-if="blogData != null" id="blogsList">
                <p class="text-center" style="font-size:24px">Blogs</p>
                <ul class="list-group">
                    <div v-for="blog in blogData">
                        <li class="list-group-item col-7 mx-auto">
                            <div class="d-flex w-100 justify-content-between blog-list" v-on:click="displayBlog(blog.blogId)">
                                <p style="font-weight:bold; font-size:22px">{{blog.title}}</p>
                                  {{blog.author}} - {{blog.dateCreated}}
                            </div>
                        </li>
                    </div>
                </ul>
            </div>


            <modal v-if="isolateModal" @close="hideBlogModal">
                <div slot="header" class="modal-header" style="width:100%">
                    <div class="text-center" style="font-weight:bold; font-size:28px">
                        <p>{{displayedBlog.title}}</p>
                    </div>
                    <div class="text-left" style="padding:30px">
                        {{displayedBlog.author}} - {{displayedBlog.dateCreated}}
                    </div>
                </div>
                <div slot="body">
                    <div class="form-group col-12">
                        <div class="input-group mb-3" style="border-style:dashed; border-color:gainsboro; border-radius:10px">
                            <p style="max-height:500px; overflow:auto">{{displayedBlog.content}}</p>
                        </div>
                        
                        <div v-if="authorizedBlog" class="text-right">
                            <button type="button" class="btn btn-outline-primary" v-on:click="editBlog()"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></button>
                            <button type="button" class="btn btn-outline-danger" v-on:click="deleteBlog()"><i class="fa fa-trash" aria-hidden="true"></i></button>
                        </div>
                        <div>
                            <div class="text-left" style="padding-left:30px">
                                <i class="fa fa-comments" aria-hidden="true"></i>Comments
                            </div>
                            <div v-if="authenticated" class="form-group text-right" style="padding-right:30px">
                                <button class="btn btn-outline-primary" type="button" v-on:click="showCommentModal()">Comment</button>
                            </div>
                        </div>
                        <div v-if="addingComment" class="form-group text-center" style="padding-left:50px; padding-top:5px; padding-bottom:5px; border-style:solid; border-block-width:1px; border-radius:10px">
                            <input class="col-8 form-control" type="text" id="newComment" v-model="newComment.content" placeholder="Enter Comment" />
                            <br>
                            <div class="text-center">
                                <button type="button" class="btn btn-outline-primary" v-on:click="addComment()"><i class="fa fa-check" aria-hidden="true"></i>Submit</button>
                                <button type="button" class="btn btn-outline-danger" v-on:click="hideCommentModal()"><i class="fa fa-times" aria-hidden="true"></i></button>
                            </div>
                        </div>
                        <div v-if="commentData != null" id="commentsList">
                            <ul class="list-group">
                                <div v-for="comment in commentData">
                                    <li class="list-group-item col-8 mx-auto">
                                        <div class="d-flex w-100 justify-content-between">
                                            <div v-if="editingComment == comment.commentId" class="text-right" style="width:100%">
                                                <input class="col-12 form-control" type="text" v-model="selectedComment.content" />
                                                <button type="button" class="btn btn-outline-primary" v-on:click="editComment(comment.commentId)"><i class="fa fa-check" aria-hidden="true"></i>Submit</button>
                                                <button type="button" class="btn btn-outline-danger" v-on:click="updateCommentEdit()"><i class="fa fa-times" aria-hidden="true"></i></button>
                                            </div>
                                            <div v-else class="text-left" style="width:100%">
                                                <br>{{comment.author}} - {{comment.dateCreated}}
                                                <input class="col-12 form-control" type="text" v-model="comment.content" style="pointer-events:none" />
                                                <div v-if="comment.userId === loggedIn" class="text-right">
                                                    <button type="button" class="btn btn-outline-primary" v-on:click="displayCommentEdit(comment.commentId, comment.content)"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></button>
                                                    <button type="button" class="btn btn-outline-danger" v-on:click="deleteComment(comment.commentId)"><i class="fa fa-trash" aria-hidden="true"></i></button>
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </li>
                                </div>
                            </ul>
                        </div>
                    </div>
                </div>
                <div slot="footer">
                    <button type="button" class="btn btn-secondary" v-on:click="hideBlogModal()">Close</button>
                </div>
            </modal>
            <modal v-if="editModal" @close="hideEditModal">
                <div slot="header" class="modal-header">
                    Edit Blog Data
                </div>
                <div slot="body">
                    <div class="form-group col-12">
                        <div class="input-group mb-3">
                            <input class="col-6 form-control" type="text" id="editBlogTitle" v-model="selectedBlog.title" placeholder="Blog Title" />
                        </div>
                        <div class="input-group mb-3">
                            <input class="col-10 form-control" type="text-multiline" id="editBlogContent" v-model="selectedBlog.content" placeholder="Blog Content" />
                        </div>
                        <div class="text-center">
                            <button type="button" class="btn btn-outline-primary" v-on:click="submitBlogEdit()"><i class="fa fa-check" aria-hidden="true"></i>Submit</button>
                            <button type="button" class="btn btn-outline-danger" v-on:click="deleteBlog()"><i class="fa fa-trash" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>
                <div slot="footer">
                    <button type="button" class="btn btn-secondary" v-on:click="hideEditModal()">Close</button>
                </div>
            </modal>
            <modal v-if="writeModal" @close="hideWriteModal">
                <div slot="header" class="modal-header">
                    Create New Blog
                </div>
                <div slot="body">
                    <div class="form-group col-12">
                        <div class="input-group mb-3">
                            <input class="col-6 form-control" type="text" id="newBlogTitle" v-model="newBlog.title" placeholder="Blog Title" />
                        </div>
                        <div class="input-group mb-3">
                            <input class="col-10 form-control" type="text-multiline" id="newBlogContent" v-model="newBlog.content" placeholder="Blog Content" />
                        </div>
                        <div class="text-center">
                            <button type="button" class="btn btn-outline-primary" v-on:click="addBlog()"><i class="fa fa-check" aria-hidden="true"></i>Submit</button>
                            <button type="button" class="btn btn-outline-danger" v-on:click="hideWriteModal()"><i class="fa fa-times" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>
                <div slot="footer">
                    <button type="button" class="btn btn-secondary" v-on:click="hideWriteModal()">Close</button>
                </div>
            </modal>
            <modal v-if="homeModal" @close="hideHomeModal">
                <div slot="header" class="modal-header" style="font-weight:bold; font-size:28px">
                    HOME - {{currentAuthor}}
                </div>
                <div slot="body">
                    <div class="text-right" style="padding-right:50px">
                        <button type="button" class="btn btn-outline-primary" v-on:click="showWriteModal()"><i class="fa fa-pencil-square-o" aria-hidden="true"></i>New Blog</button>
                    </div>
                    <p class="text-center" style="font-size:24px">My Blogs</p>
                    <div v-if="userBlogData != null" id="userBlogsList">
                        <ul class="list-group">
                            <div v-for="userBlog in userBlogData">
                                <li class="list-group-item col-7 mx-auto">
                                    <div class="d-flex w-100 justify-content-between blog-list" v-on:click="displayBlog(userBlog.blogId)">
                                        <p style="font-weight:bold; font-size:22px">{{userBlog.title}}</p>
                                          {{userBlog.author}} - {{userBlog.dateCreated}}
                                    </div>
                                </li>
                            </div>
                        </ul>
                    </div>
                </div>
                <div slot="footer">
                    <button type="button" class="btn btn-secondary" v-on:click="hideHomeModal()"><i class="fa fa-reply" aria-hidden="true"></i>Return</button>
                </div>
            </modal>
            <!-- template for the modal component -->
            <script type="text/x-template" id="modal-template">
                <transition name="modal">
                    <div class="modal-backdrop">
                        <div class="modal">
                            <header class="modal-header">
                                <slot name="header">
                                This is the default tile!
                                <button type="button" class="btn-close" @click="hideBlogModal()">
                                    x
                                </button>
                                </slot>
                            </header>
                            <section class="modal-body">
                                <slot name="body">
                                I'm the default body!
                                </slot>
                            </section>
                            <footer class="modal-footer">
                                <slot name="footer">
                                    I'm the default footer!
                                    <button type="button" class="btn-green" @click="hideBlogModal()">
                                    Close me!
                                    </button>
                                </slot>
                            </footer>
                        </div>
                    </div>
                </transition>
            </script>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="./blogs.js" ></script>
        <link rel="stylesheet" href="./project.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    </body>
</html>
